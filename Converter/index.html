<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Converter</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üì∑ Image Converter</h1>

    <input type="file" id="upload" accept=".heic, image/*" />

    <label for="format">Convert to:</label>
    <select id="format">
      <option value="image/png">PNG</option>
      <option value="image/jpeg">JPG</option>
      <option value="image/webp">WebP</option>
      <option value="image/bmp">BMP</option>
      <option value="image/gif">GIF</option>
      <option value="image/svg+xml">SVG</option>
      <option value="image/tiff">TIFF</option>
      <option value="image/x-icon">ICO</option>
      <option value="image/heic">HEIC</option>
    </select>




    <button onclick="convertImage()">Convert</button>

    <div id="preview">
      <h3>Preview:</h3>
      <img id="inputPreview" />
    </div>

    <a id="downloadLink" style="display: none;">‚¨á Download Converted Image</a>
  </div>

  <!-- heic2any library -->
  <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.3/dist/heic2any.min.js"></script>
  <script src="script.js"></script>
</body>
<body style="text-align:center; font-family:sans-serif; padding-top:50px;">
  <button id="toggleModeBtn" style="position:fixed;top:18px;right:18px;z-index:1000;padding:8px 18px;border-radius:8px;border:none;background:#222;color:#fff;cursor:pointer;box-shadow:0 2px 8px #0002;">üåô Dark Mode</button>
  <style>
    :root {
      --bg: #f4f8fb;
      --fg: #222;
      --box-bg: #fff;
      --border: #0078d4;
      --rollout-bg: #fffbe7;
      --rollout-border: #ff9800;
    }
    body {
      background: var(--bg);
      color: var(--fg);
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode {
      --bg: #181a20;
      --fg: #f4f8fb;
      --box-bg: #23262f;
      --border: #4f8cff;
      --rollout-bg: #23262f;
      --rollout-border: #fbbf24;
    }
    .container, .box, [style*="background:#f4f8fb"], [style*="background:#fffbe7"] {
      background: var(--box-bg) !important;
      color: var(--fg) !important;
      border-color: var(--border) !important;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    #rollout-header, #rollout-content {
      background: var(--rollout-bg) !important;
      color: var(--fg) !important;
      border-color: var(--rollout-border) !important;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    a, button {
      transition: background 0.3s, color 0.3s;
    }
  </style>
  <script>
    const btn = document.getElementById('toggleModeBtn');
    function setMode(dark) {
      document.body.classList.toggle('dark-mode', dark);
      btn.textContent = dark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
      btn.style.background = dark ? "#fff" : "#222";
      btn.style.color = dark ? "#222" : "#fff";
    }
    btn.onclick = () => setMode(!document.body.classList.contains('dark-mode'));
    // Optional: auto-detect system preference
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) setMode(true);
  </script>

  <div style="max-width:400px;margin:40px auto 0 auto;padding:24px;border:2px solid #0078d4;border-radius:12px;background:#f4f8fb;box-shadow:0 2px 8px #0001;">
    <h2 style="margin-top:0;">üõ†Ô∏è File Extension Renamer</h2>
    <input type="file" id="fileInput"><br><br>
    <button onclick="fixExtension()">Fix and Download</button>
    <button onclick="resetRenamer()" style="margin-left:10px;background:#f87171;color:#fff;border:none;border-radius:6px;padding:8px 18px;cursor:pointer;">Reset</button><br><br>
    <a id="downloadLink" style="display:none;">‚¨á Download Renamed File</a>
  </div>

  <script>
    function fixExtension() {
      const file = document.getElementById('fileInput').files[0];
      const downloadLink = document.getElementById('downloadLink');

      if (!file) {
        alert("Please choose a file.");
        return;
      }

      let fixedName = file.name;

      // Fix any extension that starts with a known image type, even if it has extra junk after it
      fixedName = fixedName
        .replace(/\.jpe?g[a-z0-9]*/i, ".jpg")
        .replace(/\.png[a-z0-9]*/i, ".png")
        .replace(/\.webp[a-z0-9]*/i, ".webp")
        .replace(/\.heic[a-z0-9]*/i, ".heic")
        // Also fix URL-encoded HEIC
        .replace(/\.image%2Fheic[a-z0-9]*/i, ".heic");

      const blob = new Blob([file], { type: file.type });
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.download = fixedName;
      downloadLink.style.display = 'inline-block';
      downloadLink.textContent = `Download "${fixedName}"`;
    }

    function resetRenamer() {
      document.getElementById('fileInput').value = "";
      const downloadLink = document.getElementById('downloadLink');
      downloadLink.style.display = 'none';
      downloadLink.href = "";
      downloadLink.download = "";
      downloadLink.textContent = "‚¨á Download Renamed File";
    }
  </script>

  <div style="max-width:600px;margin:40px auto 0 auto;">
    <div 
      id="rollout-header"
      style="cursor:pointer;padding:18px 24px;border:2px solid #ff9800;border-radius:12px 12px 0 0;background:#fffbe7;box-shadow:0 2px 8px #0001;font-weight:bold;font-size:1.2em;"
      onclick="toggleRollout()"
      aria-expanded="false"
    >
      ‚ñ∂ How to use our converter (by Tirev)
    </div>
    <div 
      id="rollout-content"
      style="overflow:hidden;max-height:0;transition:max-height 0.4s ease;background:#fffbe7;border:2px solid #ff9800;border-top:none;border-radius:0 0 12px 12px;box-shadow:0 2px 8px #0001;"
    >
      <div style="padding:0 24px 18px 24px;text-align:left;">
        <p>1. Upload your image file using the "Choose File" button.</p>
        <p>2. Select the desired output format (PNG, JPG, or WebP).</p>
        <p>3. Click the "Convert" button to process your image.</p>
        <p>4. Preview the converted image and download it using the provided link. (if it isn't showing up the download button wait 5-10 seconds)</p>
        <p>5. If your file has a wrong extension, use the renamer tool above to fix it. (but press the reset button to continue)</p>
        <p>6. Enjoy your converted image!</p>
        <p>PS. Don't worry you won't have any virus downloaded on it and by the way we are adding more and more missnamed extensions</p>
      </div>
    </div>
  </div>
  <script>
    function toggleRollout() {
      const content = document.getElementById('rollout-content');
      const header = document.getElementById('rollout-header');
      if (content.style.maxHeight && content.style.maxHeight !== "0px") {
        content.style.maxHeight = "0";
        header.innerHTML = "‚ñ∂ How to use our converter (by Tirev)";
        header.setAttribute('aria-expanded', 'false');
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
        header.innerHTML = "‚ñº How to use our converter (by Tirev)";
        header.setAttribute('aria-expanded', 'true');
      }
    }
  </script>
</body>
</html>
